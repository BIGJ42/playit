<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Glassmorphic Music Player</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(135deg, #1e1e2f, #12121a);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: white;
    }
    ::-webkit-scrollbar {
      width: 8px;
    }
    ::-webkit-scrollbar-thumb {
      background: #ffffff33;
      border-radius: 4px;
    }
  </style>
</head>
<body class="flex h-screen overflow-hidden">
  <!-- SONG LIST -->
  <div class="w-1/4 p-4 overflow-y-auto bg-white/10 backdrop-blur-md rounded-r-3xl shadow-md">
    <h2 class="text-xl font-bold mb-4">Songs</h2>
    <ul id="songList" class="space-y-2"></ul>
  </div>

  <!-- MAIN CONTENT -->
  <div class="flex-1 flex flex-col">
    <!-- PLAYER SECTION -->
    <div id="player" class="bg-white/10 backdrop-blur-md rounded-2xl p-4 m-4 w-full max-w-3xl self-center text-white shadow-lg">
      <div class="flex items-center justify-between mb-2">
        <div id="currentSongTitle" class="text-lg font-semibold truncate">No song playing</div>
        <div class="text-sm" id="timeDisplay">0:00 / 0:00</div>
      </div>
      <div class="flex items-center justify-center space-x-6 mb-4">
        <button id="prevBtn" class="text-white text-2xl hover:scale-110 transition">&#9664;&#9664;</button>
        <button id="playPauseBtn" class="text-white text-3xl hover:scale-110 transition">&#9654;</button>
        <button id="nextBtn" class="text-white text-2xl hover:scale-110 transition">&#9654;&#9654;</button>
      </div>
      <input type="range" id="progressBar" value="0" min="0" max="100"
             class="w-full appearance-none h-1 bg-white/30 rounded-lg cursor-pointer mb-3">
      <div class="flex items-center space-x-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" viewBox="0 0 20 20" fill="currentColor">
          <path d="M9 4.804A1 1 0 0110.777 4l6.446 3.224a1 1 0 010 1.552l-6.446 3.224A1 1 0 019 11.196V4.804zM4 5a1 1 0 011 1v8a1 1 0 01-2 0V6a1 1 0 011-1z"/>
        </svg>
        <input type="range" id="volumeControl" min="0" max="1" step="0.01" value="1"
               class="w-full max-w-xs appearance-none h-1 bg-white/30 rounded cursor-pointer">
      </div>
    </div>

    <!-- FAVORITES SECTION -->
    <div class="flex-1 overflow-y-auto p-4 bg-white/5 backdrop-blur-md rounded-t-3xl">
      <h2 class="text-xl font-bold mb-4">Favorites</h2>
      <ul id="favoritesList" class="space-y-2"></ul>
    </div>
  </div>

  <script>
    const audio = new Audio();
    let currentSongIndex = 0;
    let songs = [];

    const playPauseBtn = document.getElementById("playPauseBtn");
    const progressBar = document.getElementById("progressBar");
    const volumeControl = document.getElementById("volumeControl");
    const currentSongTitle = document.getElementById("currentSongTitle");
    const timeDisplay = document.getElementById("timeDisplay");
    const songList = document.getElementById("songList");
    const favoritesList = document.getElementById("favoritesList");

    function loadSongsFromGitHub() {
      fetch("https://api.github.com/repos/bigj42/playit/contents/drive.google.com/music")
        .then(res => res.json())
        .then(data => {
          songs = data.filter(file => file.name.endsWith(".mp3"))
                      .map(file => ({ name: file.name, url: file.download_url }));
          renderSongs();
        });
    }

    function renderSongs() {
      songList.innerHTML = "";
      songs.forEach((song, index) => {
        const li = document.createElement("li");
        li.className = "flex justify-between items-center p-2 bg-white/10 rounded hover:bg-white/20 cursor-pointer";
        li.innerHTML = `
          <span>${song.name}</span>
          <button onclick="toggleFavorite(${index})">❤️</button>
        `;
        li.onclick = () => playSong(index);
        songList.appendChild(li);
      });
      loadFavorites();
    }

    function playSong(index) {
      if (songs.length === 0) return;
      currentSongIndex = index;
      audio.src = songs[index].url;
      currentSongTitle.textContent = songs[index].name;
      audio.play();
      playPauseBtn.innerHTML = "❚❚";
    }

    function toggleFavorite(index) {
      const favs = JSON.parse(localStorage.getItem("favorites") || "[]");
      const exists = favs.find(f => f.name === songs[index].name);
      if (exists) {
        localStorage.setItem("favorites", JSON.stringify(favs.filter(f => f.name !== songs[index].name)));
      } else {
        favs.push(songs[index]);
        localStorage.setItem("favorites", JSON.stringify(favs));
      }
      loadFavorites();
    }

    function loadFavorites() {
      const favs = JSON.parse(localStorage.getItem("favorites") || "[]");
      favoritesList.innerHTML = "";
      favs.forEach((song, index) => {
        const li = document.createElement("li");
        li.className = "flex justify-between items-center p-2 bg-white/10 rounded hover:bg-white/20 cursor-pointer";
        li.innerHTML = `<span>${song.name}</span>`;
        li.onclick = () => {
          audio.src = song.url;
          currentSongTitle.textContent = song.name;
          audio.play();
          playPauseBtn.innerHTML = "❚❚";
        };
        favoritesList.appendChild(li);
      });
    }

    playPauseBtn.onclick = () => {
      if (audio.paused) {
        audio.play();
        playPauseBtn.innerHTML = "❚❚";
      } else {
        audio.pause();
        playPauseBtn.innerHTML = "▶";
      }
    };

    document.getElementById("prevBtn").onclick = () => {
      currentSongIndex = (currentSongIndex - 1 + songs.length) % songs.length;
      playSong(currentSongIndex);
    };

    document.getElementById("nextBtn").onclick = () => {
      currentSongIndex = (currentSongIndex + 1) % songs.length;
      playSong(currentSongIndex);
    };

    progressBar.addEventListener("input", () => {
      audio.currentTime = (progressBar.value / 100) * audio.duration;
    });

    volumeControl.addEventListener("input", () => {
      audio.volume = volumeControl.value;
    });

    audio.addEventListener("timeupdate", () => {
      if (!isNaN(audio.duration)) {
        progressBar.value = (audio.currentTime / audio.duration) * 100;
        const formatTime = (t) => `${Math.floor(t / 60)}:${String(Math.floor(t % 60)).padStart(2, "0")}`;
        timeDisplay.textContent = `${formatTime(audio.currentTime)} / ${formatTime(audio.duration)}`;
      }
    });

    loadSongsFromGitHub();
  </script>
</body>
</html>
